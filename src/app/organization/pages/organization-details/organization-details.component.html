<div class="organization-details">
  <!-- Breadcrumb -->
  <nz-breadcrumb class="mb-6">
    <nz-breadcrumb-item>
      <a (click)="goBack()">Organizations</a>
    </nz-breadcrumb-item>
    <nz-breadcrumb-item>{{ organization?.name || 'Loading...' }}</nz-breadcrumb-item>
  </nz-breadcrumb>

  <div *ngIf="organization">
    <!-- Organization Header -->
    <div class="mb-8">
      <div class="flex items-start justify-between">
        <div class="flex items-start gap-4">
          <div class="w-16 h-16 bg-gradient-to-br from-blue-500 to-purple-600 rounded-xl flex items-center justify-center text-white text-2xl font-bold">
            {{ getOrganizationInitials() }}
          </div>
          <div>
            <h1 class="text-3xl font-bold text-gray-900 mb-2">{{ organization.name }}</h1>
            <p class="text-lg text-gray-600 mb-4">{{ organization.description }}</p>
            <div class="flex items-center gap-4 text-sm text-gray-500">
              <span class="flex items-center gap-1">
                <span nz-icon nzType="team" nzTheme="outline"></span>
                {{ organization.memberCount }} member{{ organization.memberCount !== 1 ? 's' : '' }}
              </span>
              <span class="flex items-center gap-1">
                <span nz-icon nzType="apartment" nzTheme="outline"></span>
                {{ organization.teamCount }} team{{ organization.teamCount !== 1 ? 's' : '' }}
              </span>
              <span>Created {{ organization.createdAt | date:'MMM d, yyyy' }}</span>
            </div>
          </div>
        </div>
        
        <div class="flex items-center gap-3">
          <button 
            nz-button 
            nzType="default"
            nzSize="medium"
            (click)="showLinkJiraModal()"
            class="flex items-center gap-2 jira-link-button"
            [class.linked]="organization.jiraIntegration?.isConnected"
          >
            <span nz-icon nzType="link" nzTheme="outline"></span>
            {{ organization.jiraIntegration?.isConnected ? 'Manage Jira' : 'Link Jira' }}
          </button>
          <button 
            nz-button 
            nzType="default"
            nzSize="medium"
            (click)="showInviteMemberModal()"
            class="flex items-center gap-2"
          >
            <span nz-icon nzType="user-add" nzTheme="outline"></span>
            Invite Members
          </button>
          <button 
            nz-button 
            nzType="primary"
            nzSize="medium"
            (click)="showCreateTeamModal()"
            class="flex items-center gap-2"
          >
            <span nz-icon nzType="plus" nzTheme="outline"></span>
            Create Team
          </button>
        </div>
      </div>
    </div>

    <!-- Content Grid -->
    <nz-row [nzGutter]="[24, 24]">
      <!-- Teams Section -->
      <nz-col [nzSpan]="16">
        <nz-card nzTitle="Teams" class="h-full">
          <div *ngIf="teams.length > 0" class="teams-grid">
            <app-team-card
              *ngFor="let team of teams; trackBy: trackByTeamId"
              [team]="team"
              (cardClick)="onTeamClick($event)"
              (settings)="onTeamSettings($event)"
              (delete)="onTeamDelete($event)"
            ></app-team-card>
          </div>

          <!-- Empty Teams State -->
          <div *ngIf="teams.length === 0" class="empty-state">
            <nz-empty nzNotFoundImage="simple">
              <div nz-empty-content class="text-center py-8">
                <div class="mb-4">
                  <span nz-icon nzType="team" nzTheme="outline" class="text-4xl text-gray-300"></span>
                </div>
                <h3 class="text-lg font-medium text-gray-900 mb-2">No teams yet</h3>
                <p class="text-gray-500 mb-4">Create your first team to organize members and projects</p>
                <button 
                  nz-button 
                  nzType="primary"
                  nzSize="medium"
                  (click)="showCreateTeamModal()"
                  class="flex items-center gap-2 mx-auto"
                >
                  <span nz-icon nzType="plus" nzTheme="outline"></span>
                  Create First Team
                </button>
              </div>
            </nz-empty>
          </div>
        </nz-card>
      </nz-col>

      <!-- Members Section -->
      <nz-col [nzSpan]="8">
        <nz-card nzTitle="Members" class="h-full">
          <div *ngIf="members.length > 0">
            <div class="member-list space-y-3">
              <div 
                *ngFor="let member of members; trackBy: trackByMemberId"
                class="flex items-center justify-between p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors"
              >
                <div class="flex items-center gap-3">
                  <nz-avatar 
                    [nzSrc]="member.user.avatarUrl" 
                    [nzText]="member.user.name"
                    nzSize="medium"
                  ></nz-avatar>
                  <div>
                    <div class="font-medium text-gray-900">{{ member.user.name }}</div>
                    <div class="text-sm text-gray-500">{{ member.user.email }}</div>
                  </div>
                </div>
                <div class="flex flex-col items-end gap-1">
                  <nz-tag [nzColor]="getRoleColor(member.role)" nzSize="medium">
                    {{ member.role }}
                  </nz-tag>
                  <nz-tag [nzColor]="getStatusColor(member.status)" nzSize="medium">
                    {{ member.status }}
                  </nz-tag>
                </div>
              </div>
            </div>
          </div>

          <!-- Empty Members State -->
          <div *ngIf="members.length === 0" class="empty-state">
            <nz-empty nzNotFoundImage="simple">
              <div nz-empty-content class="text-center py-8">
                <div class="mb-4">
                  <span nz-icon nzType="user" nzTheme="outline" class="text-4xl text-gray-300"></span>
                </div>
                <h3 class="text-lg font-medium text-gray-900 mb-2">No members yet</h3>
                <p class="text-gray-500 mb-4">Invite people to join this organization</p>
                <button 
                  nz-button 
                  nzType="primary"
                  nzSize="medium"
                  (click)="showInviteMemberModal()"
                  class="flex items-center gap-2 mx-auto"
                >
                  <span nz-icon nzType="user-add" nzTheme="outline"></span>
                  Invite Members
                </button>
              </div>
            </nz-empty>
          </div>
        </nz-card>
      </nz-col>
    </nz-row>
  </div>

  <!-- Loading State -->
  <div *ngIf="!organization" class="text-center py-12">
    <div class="text-lg text-gray-500">Loading organization details...</div>
  </div>
</div>

<!-- Jira Link Management Modal -->
<nz-modal
  [(nzVisible)]="isJiraLinkModalVisible"
  [nzTitle]="null"
  [nzFooter]="null"
  [nzClosable]="false"
  (nzOnCancel)="cancelJiraLink()"
  nzWidth="900px"
  nzBodyStyle="padding: 0"
  nzClassName="jira-modal"
>
  <ng-container *nzModalContent>
    <div class="jira-modal-container">
      <!-- Modern Header -->
      <div class="modal-header">
        <div class="header-content">
          <div class="header-icon">
            <span nz-icon nzType="api" nzTheme="outline" class="icon"></span>
          </div>
          <div class="header-text">
            <h2 class="title">Jira Integration</h2>
            <p class="subtitle">Connect {{ organization?.name }} to Jira for seamless project management</p>
          </div>
        </div>
        <button 
          nz-button 
          nzType="text" 
          nzSize="medium"
          (click)="cancelJiraLink()"
          class="close-btn"
        >
          <span nz-icon nzType="close" nzTheme="outline"></span>
        </button>
      </div>

      <!-- Content Area -->
      <div class="modal-content">
        <div class="org-details-header" *ngIf="organization">
          <div class="org-avatar">
            {{ getOrganizationInitials() }}
          </div>
          <div class="org-info">
            <h3 class="org-name">{{ organization.name }}</h3>
            <div class="connection-status" [class.connected]="organization.jiraIntegration?.isConnected">
              <div class="status-dot"></div>
              <span>{{ organization.jiraIntegration?.isConnected ? 'Jira Integration Active' : 'Not connected' }}</span>
            </div>
          </div>
        </div>

        <!-- Not Connected State -->
        <div *ngIf="!organization?.jiraIntegration?.isConnected" class="connection-form">
          <form nz-form [nzLayout]="'vertical'" class="modern-form">
            <nz-form-item>
              <nz-form-label nzRequired>Jira Site URL</nz-form-label>
              <nz-form-control>
                <nz-input-group nzPrefixIcon="global">
                  <input 
                    nz-input 
                    [(ngModel)]="jiraConfig.siteUrl" 
                    name="siteUrl"
                    placeholder="https://yourcompany.atlassian.net"
                  />
                </nz-input-group>
              </nz-form-control>
            </nz-form-item>

            <div class="form-actions">
              <button 
                nz-button 
                nzType="primary" 
                nzSize="medium"
                (click)="connectJira()"
                [nzLoading]="isConnecting"
                [disabled]="!jiraConfig.siteUrl?.trim()"
                class="action-btn primary"
              >
                <span nz-icon nzType="thunderbolt" nzTheme="outline" *ngIf="!isConnecting"></span>
                {{ isConnecting ? 'Connecting...' : 'Connect to Jira' }}
              </button>
            </div>
          </form>
        </div>

        <!-- Connected State -->
        <div *ngIf="organization?.jiraIntegration?.isConnected" class="connected-state">
          <div class="connection-details">
            <div class="detail-row">
              <div class="detail-label">
                <span nz-icon nzType="global" nzTheme="outline"></span>
                Jira Site
              </div>
              <div class="detail-value">{{ organization.jiraIntegration?.siteUrl }}</div>
            </div>
            <div class="detail-row">
              <div class="detail-label">
                <span nz-icon nzType="calendar" nzTheme="outline"></span>
                Connected
              </div>
              <div class="detail-value">{{ organization.jiraIntegration?.connectedAt | date:'MMM d, yyyy \'at\' h:mm a' }}</div>
            </div>
          </div>

          <div class="connection-actions">
            <button 
              nz-button 
              nzType="primary" 
              nzDanger
              nzSize="medium"
              (click)="disconnectJira()"
              [nzLoading]="isDisconnecting"
              class="action-btn danger"
            >
              <span nz-icon nzType="disconnect" nzTheme="outline" *ngIf="!isDisconnecting"></span>
              {{ isDisconnecting ? 'Disconnecting...' : 'Disconnect' }}
            </button>
          </div>
        </div>
      </div>
    </div>
  </ng-container>
</nz-modal>